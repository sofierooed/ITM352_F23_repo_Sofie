<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shoppingcart</title>
    <link rel="stylesheet" href="cart-style.css">
    <script src="./product_data.js" type="text/javascript"></script>
</head>

<script>

    //Function to create navbar from A3 code examples
    function nav_bar() {
        document.write(`<a href='./index.html'>Home</a>&nbsp&nbsp&nbsp;`);
        document.write(`<a href='./product_display.html'>Products</a>&nbsp&nbsp&nbsp;`);
        document.write(`<a href='./login.html'>Login</a>&nbsp&nbsp&nbsp;`);
    }
    // This function asks the server for a "service" and converts the response to text. 
    // Function from A3 code examples
    function loadJSON(service, callback) {
        let xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('POST', service, false);
        xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
                // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                callback(xobj.responseText);
            }
        };
        xobj.send(null);
    }

    //Get shoppingcart data for user session from server, from A3 code examples
    loadJSON('get_cart', function (response) {
        // Parsing JSON string into object
        shopping_cart = JSON.parse(response);
    });

    let quantities = [];
    /* Function to generate invoice rows */
    // Inspired by previous labs
    function generate_item_rows(products) {
        // Loop through the product quantities array
        for (let pkey in shopping_cart) {
            let products = all_products[pkey];

            for (let i = 0; i < products.length; i++) {
                // Retrieve the quantity for the current product
                let quantity = shopping_cart[pkey][`quantity${i}`];

                // Check if the quantity is greater than 0 before generating the table row
                if (quantity > 0) {
                    // Calculate the extended price for the product
                    let extended_price = quantity * products[i].price;

                    // Output a table row with product information and the calculated extended price, using a template string.
                    //Included Assignment 1 IR5 styled in css sheet
                    document.write(`
                <tr class="item">
                    <td width="43%">
                        <div class="img_block">
                            <img src="${products[i].image}" >
                        </div>
                    </td>
                    <td>
                        ${products[i].name}
                    </td>
                    <td align="center" width="11%">${quantity}</td>
                    <td width="13%">$${products[i].price}</td>
                </tr>
    `);
                }
            }
        }
    }

</script>

<body>
    <header>
        <h3 style="display: flex; justify-content: space-between;">
            <a>BY.SOFIE</a>
            <span>YOUR SHOPPINGCART</span>
            <form action="/logout" method="POST">
                <button class="log_out_button">log out</button>
            </form>
        </h3>
        <div class="topnav">
            <script>
                nav_bar();
            </script>
        </div>

    </header>

    <main>
        <table>
            <tr class="heading">
                <td>Image</td>
                <td>Item</td>
                <td>Quantity</td>
                <td>Price</td>
            </tr>
            <script>
                generate_item_rows(quantities);
            </script>
        </table>
        <a href="./invoice.html" class="confirm_purchase_button">Confirm Purchase</a>
    </main>
</body>

</html>