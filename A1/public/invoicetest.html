<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice</title>
    <script src="./product_data.js" type="text/javascript"></script>
    <link rel="stylesheet" href="invoice.css">

    <script>
        let params = (new URL(document.location)).searchParams;
    </script>
    <script>

        // Sub-Total
        let subtotal = 0;
        // shipping 
        let shipping;
        let qty;


        function generate_item_rows() {
            // function to generate item rows based on products array and the quantities in the query string

            // loop through products to generate a row for each product and quantity 
            for (let i in products) {
                //get the quantity for [i]th product from the query string

                if (params.has(`quantities${i}`)) {
                    let qty = params.get(`quantities${i}`);

                    //skip items with no quantities
                    if (qty == 0) {
                        continue;
                    }

                    //set extended price
                    let extended_price = qty * products[i].price;


                    // generate item rows 
                    document.write(`
                <tr>
                  <td align="center" width="43%"><img src="${products[i].img}" alt="description" width="30%" height="30%" title="${products[i].description}"><div><div><div>${products[i].name}</td>
                  <td align="center" width="11%">${qty}</td>
                  <td align="center" width="13%">$${products[i].price}</div></td>
                  <td width="43%">$${extended_price.toFixed(2)}</td>
                </tr>
          `)
                    subtotal += extended_price
                }
            }
        }


    </script>

    <!--JS to generate todays date using DOM, retrieved from ChatGPT-->
    <script>
        // Wait for the DOM content to be fully loaded before executing the script
        document.addEventListener("DOMContentLoaded", function () {

            // Get the element with the id "invoiceDate" from the HTML
            let dateElement = document.getElementById("invoiceDate");

            // Create a new Date object to represent the current date and time
            // Convert the date to a string in a human-readable format using toDateString()
            let currentDate = new Date().toDateString();

            // Set the innerHTML of the selected element to display the current date 
            dateElement.innerHTML = new Date().toDateString();
        });
    </script>
</head>

<body>
    <div class="invoice-box">
        <table cellpadding="0" cellspacing="0">
            <tr class="top">
                <td colspan="2">
                    <table>
                        <tr class="top">
                            <td class="title">
                                by.Sofie
                            </td>
                            <td>
                                Invoice<br />
                                Created: <span id="invoiceDate"></span><br />
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>

            <tr class="information">
                <td colspan="2">
                    <table>
                        <tr>
                            <td>
                                by.Sofie<br />
                                Inkognitogata<br />
                                0258 Oslo, Norway
                            </td>

                        </tr>
                    </table>
                </td>
            </tr>
            <!-- Table headers-->
            <tr class="heading">
                <td>Item</td>
                <td>Quantity</td>
                <td>Price</td>
                <td>Extended Price</td>
            </tr>

            <script>
                //call the function 
                generate_item_rows();


                // Sales Tax
                taxRate = 5.75 / 100;
                salesTax = subtotal * taxRate;

                //Shipping Costs
                shipping;
                if (subtotal <= 50) {
                    shipping = 2;
                }
                if (subtotal > 50 && subtotal <= 100) {
                    shipping = 5;
                }
                if (subtotal > 100) {
                    shipping = subtotal * 0.05;
                }

                // Grand Sales Total
                total = subtotal + salesTax + shipping;

            </script>
            <tr>
                <td style="text-align: center;" colspan="3" width="67%">Sub-total</td>
                <td width="54%">$
                    <script>document.write(subtotal.toFixed(2))</script>
                </td>
            </tr>
            <tr>
                <td style="text-align: center;" colspan="3" width="67%"><span style="font-family: arial;">Tax @
                        5.75%</span>
                </td>
                <td width="54%">$
                    <script>document.write(salesTax.toFixed(2))</script>
                </td>

            </tr>

            <tr>
                <td style="text-align: center;" colspan="3" width="67%"><span
                        style="font-family: arial;">Shipping</span></td>
                <td width="54%">$
                    <script>document.write(shipping.toFixed(2))</script>
                </td>

            </tr>

            <tr>
                <td style="text-align: center;" colspan="3" width="67%"><strong><strong>Total</strong></strong></td>
                <td width="54%"><strong>$
                        <script>document.write(total.toFixed(2))</script>
                    </strong></td>
            </tr>

            <!--Loop for invoice-->
            <!--
            <tr class="item">
                <td>Website design</td>

                <td>$300.00</td>
            </tr>

            <tr class="item">
                <td>Hosting (3 months)</td>

                <td>$75.00</td>
            </tr>

            <tr class="item">
                <td>Domain name (1 year)</td>

                <td>$10.00</td>
            </tr>

            
            <tr class="subtotal">
                <td></td>
                <td></td>
                <td></td>
                <td>Sub total: $385.00</td>
            </tr>

            <tr class="heading2">
                <td> Tax </td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="heading2">
                <td> Shipping </td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="heading">
                <td> Total </td>
                <td></td>
                <td></td>
                <td></td>
            </tr>-->
        </table>
    </div>
</body>

</html>


</body>

</html>